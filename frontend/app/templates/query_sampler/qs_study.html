{# templates/query_sampler/show_qs_study.html #}
{% extends "master.html" %}

{% block title %}Query Sampler Dashboard{% endblock %}
{% block head %}{{ super() }}{% endblock %}

{% block content %}
<div class="row">
    <div class="pb-4">
        <a class="text-dark" href="{{ url_for('qs_studies') }}">
            <i class="fa-solid fa-angle-left me-2"></i> Back to Dashboard
        </a>
    </div>

    <div class="col-md-8 offset-md-2">
        <div class="card shadow-sm">
            <div class="card-body">
                <h3 class="border-bottom pb-3 mb-3">Study: {{ study.name }}</h3>

                <div class="mb-4">
                    <h4 class="crd-header mb-3">Seed Keywords & Targeting</h4>
                    {% if keywords %}
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Keyword</th>
                                <th>Language</th>
                                <th>Country</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for k in keywords %}
                            <tr>
                                <td>{{ k.keyword }}</td>
                                <td>{{ k.language }}</td>
                                <td>{{ k.region }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p class="text-muted">No keywords found for this study.</p>
                    {% endif %}
                </div>

                <hr />

                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h4 class="crd-header">Keyword Ideas</h4>
                        <p class="mb-2">
                            <span class="keyword_ideas">Generated ideas: <strong>{{ keyword_ideas_count }}</strong></span>
                        </p>
                        
                        {% if keyword_ideas_count > 0 %}
                        <a href="{{ url_for('export_keyword_ideas', id=study.id) }}" class="btn btn-success btn-sm" id="download_button">
                            <i class="fa-solid fa-download me-2"></i>Download Keyword Ideas
                        </a>
                        {% else %}
                        <button class="btn btn-secondary btn-sm" disabled>Download Keyword Ideas</button>
                        {% endif %}
                    </div>

                    <div class="col-md-6 text-end">
                        <h4 class="crd-header">Actions</h4>
                        {% if status %}
                        
                        {% else %}
                            <button class="btn btn-info" disabled>
                                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                Generation in Progress...
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}